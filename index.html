<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finflux Reports Dashboard</title>
    <!-- Use Tailwind CSS via CDN for rapid styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Define a custom font for a clean, modern look */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for a nicer user experience */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e2e8f0;
        }
        ::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        /* Modal-specific styling for the overlay */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
        }
        /* Custom spin animation for the running icon */
        @keyframes spin {
          from {
            transform: rotate(0deg);
          }
          to {
            transform: rotate(360deg);
          }
        }
        .animate-spin {
          animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col h-screen overflow-hidden">

    <!-- Login Page Container -->
    <div id="login-page" class="flex items-center justify-center h-full p-4">
        <div class="w-full max-w-md bg-white p-8 rounded-2xl shadow-xl border border-gray-200">
            <div class="flex flex-col items-center mb-6">
                <!-- Finflux-themed bar chart logo -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-blue-700" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M4 12h3v8H4zM10.5 5h3v15h-3zM17 9h3v11h-3z"/>
                </svg>
                <h2 class="mt-4 text-3xl font-bold text-gray-900">Finflux Login</h2>
                <p class="mt-2 text-sm text-gray-600">Sign in to your account</p>
            </div>
            <form id="login-form" class="space-y-6">
                <div>
                    <label for="username" class="block text-sm font-medium text-gray-700">Username</label>
                    <input id="username" type="text" placeholder="Enter username" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition-colors">
                </div>
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                    <input id="password" type="password" placeholder="Enter password" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition-colors">
                </div>
                <div id="login-error" class="text-sm text-red-600 text-center hidden">
                    Incorrect username or password.
                </div>
                <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-lg shadow-sm text-sm font-semibold text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                    Login
                </button>
            </form>
        </div>
    </div>

    <!-- Main Application Container (hidden by default) -->
    <div id="main-app" class="flex flex-col h-screen overflow-hidden hidden">
        <!-- Top Navigation Bar -->
        <nav class="bg-white shadow-md p-4 md:px-6 flex items-center justify-between z-10">
            <!-- Logo and App Name -->
            <div class="flex items-center space-x-2">
                <!-- Finflux-themed bar chart logo -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-700" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M4 12h3v8H4zM10.5 5h3v15h-3zM17 9h3v11h-3z"/>
                </svg>
                <span class="text-xl font-bold text-gray-800">Finflux</span>
            </div>

            <!-- Desktop Navigation Links -->
            <div class="hidden md:flex items-center space-x-8">
                <!-- Navigation links for different pages -->
                <button onclick="showPage(event, 'dashboard')" id="dashboard-nav-link" class="nav-link flex items-center space-x-1 text-gray-700 hover:text-blue-700 transition duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                    </svg>
                    <span>Dashboard</span>
                </button>
                <button onclick="showPage(event, 'reports')" id="reports-nav-link" class="nav-link flex items-center space-x-1 text-gray-700 hover:text-blue-700 transition duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-3-3v6m-4-6h8a2 2 0 012 2v4a2 2 0 01-2 2h-8a2 2 0 01-2-2v-4a2 2 0 012-2z" />
                    </svg>
                    <span>Reports</span>
                </button>
                <button onclick="showPage(event, 'transactions')" id="transactions-nav-link" class="nav-link flex items-center space-x-1 text-gray-700 hover:text-blue-700 transition duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M3 14h18m-9-4v8m-7-8v8M10 10v8" />
                    </svg>
                    <span>Transactions</span>
                </button>
                <button onclick="showPage(event, 'analytics')" id="analytics-nav-link" class="nav-link flex items-center space-x-1 text-gray-700 hover:text-blue-700 transition duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M7 12l2 2 4-4m6 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span>Analytics</span>
                </button>
                <button onclick="showPage(event, 'settings')" id="settings-nav-link" class="nav-link flex items-center space-x-1 text-gray-700 hover:text-blue-700 transition duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.298.608 3.3 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    <span>Settings</span>
                </button>
            </div>
            <!-- User Profile -->
            <div class="flex items-center space-x-4">
                <div class="w-10 h-10 rounded-full bg-indigo-200 flex items-center justify-center text-indigo-600 font-bold">
                    SR
                </div>
            </div>
        </nav>
        
        <div class="flex-1 flex overflow-hidden">
            <!-- Sidebar -->
            <aside class="w-20 bg-white shadow-lg p-4 flex flex-col justify-between hidden md:flex">
                <div class="space-y-4">
                    <!-- Sidebar Icons -->
                    <button onclick="showPage(event, 'dashboard')" class="nav-link-sidebar block p-3 rounded-xl bg-indigo-50 text-indigo-600 transition duration-200 hover:bg-indigo-100 group">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16m-7 6h7" />
                        </svg>
                    </button>
                    <button onclick="showPage(event, 'reports')" class="nav-link-sidebar block p-3 rounded-xl text-gray-400 transition duration-200 hover:bg-gray-100 hover:text-gray-600 group">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-3-3v6m-4-6h8a2 2 0 012 2v4a2 2 0 01-2 2h-8a2 2 0 01-2-2v-4a2 2 0 012-2z" />
                        </svg>
                    </button>
                    <button onclick="showPage(event, 'transactions')" class="nav-link-sidebar block p-3 rounded-xl text-gray-400 transition duration-200 hover:bg-gray-100 hover:text-gray-600 group">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M3 14h18m-9-4v8m-7-8v8M10 10v8" />
                        </svg>
                    </button>
                    <button onclick="showPage(event, 'analytics')" class="nav-link-sidebar block p-3 rounded-xl text-gray-400 transition duration-200 hover:bg-gray-100 hover:text-gray-600 group">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M7 12l2 2 4-4m6 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </button>
                    <button onclick="showPage(event, 'settings')" class="nav-link-sidebar block p-3 rounded-xl text-gray-400 transition duration-200 hover:bg-gray-100 hover:text-gray-600 group">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
                        </svg>
                    </button>
                </div>
            </aside>
            
        <!-- Main Content Area -->
        <main class="flex-1 p-4 md:p-8 overflow-y-auto">
            <div id="dashboard-page" class="page-content">
                <h1 class="text-3xl font-bold text-gray-900 mb-6">Dashboard</h1>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <!-- Dashboard Card 1: Total Loans -->
                    <div class="bg-white p-6 rounded-2xl shadow-md border border-gray-200">
                        <div class="flex items-center justify-between">
                            <p class="text-lg font-medium text-gray-500">Total Loans</p>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2m0-4c1.657 0 3 .895 3 2s-1.343 2-3 2m0-4v4" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 12c-1.657 0-3 .895-3 2s1.343 2 3 2m0-4c1.657 0 3 .895 3 2s-1.343 2-3 2m0-4v4" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 12c-1.657 0-3 .895-3 2s1.343 2 3 2m0-4c1.657 0 3 .895 3 2s-1.343 2-3 2m0-4v4" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 12c-1.657 0-3 .895-3 2s1.343 2 3 2m0-4c1.657 0 3 .895 3 2s-1.343 2-3 2m0-4v4" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 12c-1.657 0-3 .895-3 2s1.343 2 3 2m0-4c1.657 0 3 .895 3 2s-1.343 2-3 2m0-4v4" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 12c-1.657 0-3 .895-3 2s1.343 2 3 2m0-4c1.657 0 3 .895 3 2s-1.343 2-3 2m0-4v4" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-3-3v6m-4-6h8a2 2 0 012 2v4a2 2 0 01-2 2h-8a2 2 0 01-2-2v-4a2 2 0 012-2z" />
                            </svg>
                        </div>
                        <p class="text-3xl font-semibold text-gray-900 mt-4">1,250</p>
                        <p class="text-sm text-gray-400 mt-1">Total active loans</p>
                    </div>

                    <!-- Dashboard Card 2: Active Clients -->
                    <div class="bg-white p-6 rounded-2xl shadow-md border border-gray-200">
                        <div class="flex items-center justify-between">
                            <p class="text-lg font-medium text-gray-500">Active Clients</p>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                            </svg>
                        </div>
                        <p class="text-3xl font-semibold text-gray-900 mt-4">980</p>
                        <p class="text-sm text-gray-400 mt-1">Clients with an active loan</p>
                    </div>

                    <!-- Dashboard Card 3: Overdue Payments -->
                    <div class="bg-white p-6 rounded-2xl shadow-md border border-gray-200">
                        <div class="flex items-center justify-between">
                            <p class="text-lg font-medium text-gray-500">Overdue Payments</p>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <p class="text-3xl font-semibold text-gray-900 mt-4">15</p>
                        <p class="text-sm text-gray-400 mt-1">Accounts with payments past due</p>
                    </div>

                    <!-- Dashboard Card 4: New Clients (last 30 days) -->
                    <div class="bg-white p-6 rounded-2xl shadow-md border border-gray-200">
                        <div class="flex items-center justify-between">
                            <p class="text-lg font-medium text-gray-500">New Clients</p>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-yellow-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM12 12v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0z" />
                            </svg>
                        </div>
                        <p class="text-3xl font-semibold text-gray-900 mt-4">75</p>
                        <p class="text-sm text-gray-400 mt-1">Clients added in the last 30 days</p>
                    </div>
                </div>
            </div>

            <!-- Reports Page (Updated) -->
            <div id="reports-page" class="page-content hidden">
                <h1 class="text-3xl font-bold text-gray-900 mb-6">Reports</h1>
                <div class="bg-white p-6 rounded-2xl shadow-xl border border-gray-200">
                    <div class="border-b border-gray-200">
                        <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                            <!-- Only one tab for all reports -->
                            <button onclick="showReportTab(event, 'all-jobs')" class="report-tab-link whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-blue-500 text-blue-600 focus:outline-none">
                                All Jobs
                            </button>
                        </nav>
                    </div>

                    <div id="reports-tab-content" class="mt-4">
                        <div id="all-jobs-tab" class="report-tab-content">
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Name
                                            </th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Status
                                            </th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Next Run
                                            </th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Previous Run
                                            </th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Error Log
                                            </th>
                                            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Actions
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody id="all-jobs-table-body" class="bg-white divide-y divide-gray-200">
                                        <!-- Job rows will be dynamically inserted here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Placeholder Pages -->
            <div id="transactions-page" class="page-content hidden">
                <h1 class="text-3xl font-bold text-gray-900 mb-6">Transactions</h1>
                <div class="bg-white p-6 rounded-2xl shadow-md border border-gray-200">
                    <p class="text-gray-600">Transaction details will be displayed here.</p>
                </div>
            </div>
            <div id="analytics-page" class="page-content hidden">
                <h1 class="text-3xl font-bold text-gray-900 mb-6">Analytics</h1>
                <div class="bg-white p-6 rounded-2xl shadow-md border border-gray-200">
                    <p class="text-gray-600">Analytics charts and insights will be displayed here.</p>
                </div>
            </div>
            <div id="settings-page" class="page-content hidden">
                <h1 class="text-3xl font-bold text-gray-900 mb-6">Settings</h1>
                <div class="bg-white p-6 rounded-2xl shadow-md border border-gray-200">
                    <p class="text-gray-600">User and application settings will be managed here.</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Reschedule Modal -->
    <div id="reschedule-modal" class="fixed inset-0 z-50 overflow-y-auto hidden">
        <div class="flex items-center justify-center min-h-screen px-4">
            <!-- Modal Overlay -->
            <div class="fixed inset-0 transition-opacity modal-overlay" onclick="closeRescheduleModal()"></div>
            
            <!-- Modal Content -->
            <div class="bg-white rounded-xl shadow-2xl overflow-hidden transform transition-all sm:max-w-md w-full p-6 relative">
                <div class="flex justify-between items-center pb-4 border-b border-gray-200">
                    <h3 class="text-lg font-bold text-gray-900">Reschedule Job</h3>
                    <button onclick="closeRescheduleModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                <div class="mt-4">
                    <p class="text-sm text-gray-500 mb-4">Select a new date and time for the job to run.</p>
                    <form id="reschedule-form" onsubmit="event.preventDefault(); handleRescheduleSubmit(event);">
                        <input type="hidden" id="reschedule-job-id">
                        <div class="space-y-4">
                            <div>
                                <label for="reschedule-date" class="block text-sm font-medium text-gray-700">Date</label>
                                <input type="date" id="reschedule-date" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" required>
                            </div>
                            <div>
                                <label for="reschedule-time" class="block text-sm font-medium text-gray-700">Time</label>
                                <input type="time" id="reschedule-time" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" required>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="fail-job-checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                <label for="fail-job-checkbox" class="ml-2 block text-sm text-gray-900">Fail this job</label>
                            </div>
                        </div>
                        <div class="mt-6 flex justify-end space-x-3">
                            <button type="button" onclick="closeRescheduleModal()" class="inline-flex justify-center px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 border border-transparent rounded-md shadow-sm hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors">
                                Cancel
                            </button>
                            <button type="submit" class="inline-flex justify-center px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                                Save
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast message container -->
    <div id="toast-container" class="fixed top-4 right-4 z-50"></div>

<script>
    // Data for user authentication
    const users = {
        'Sri': '1234',
    };

    // UI element references
    const loginPage = document.getElementById('login-page');
    const mainApp = document.getElementById('main-app');
    const loginForm = document.getElementById('login-form');
    const loginError = document.getElementById('login-error');
    const allJobsTableBody = document.getElementById('all-jobs-table-body');
    const rescheduleModal = document.getElementById('reschedule-modal');
    const rescheduleJobIdInput = document.getElementById('reschedule-job-id');
    const rescheduleDateInput = document.getElementById('reschedule-date');
    const rescheduleTimeInput = document.getElementById('reschedule-time');
    const failJobCheckbox = document.getElementById('fail-job-checkbox');
    const toastContainer = document.getElementById('toast-container');
    const navLinks = document.querySelectorAll('.nav-link');
    const sidebarLinks = document.querySelectorAll('.nav-link-sidebar');
    const pages = document.querySelectorAll('.page-content');
    const reportTabLinks = document.querySelectorAll('.report-tab-link');
    const reportTabContents = document.querySelectorAll('.report-tab-content');

    /**
     * Creates a job object with dynamic dates based on the scheduled hour.
     * @param {number} id The job's unique ID.
     * @param {string} name The job's name.
     * @param {number} hour The scheduled hour (0-23).
     * @param {number} minute The scheduled minute (0-59).
     */
    function createJob(id, name, hour, minute) {
        const now = new Date();
        const nextRun = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hour, minute, 0);

        // If the scheduled time is in the past, schedule it for the next day.
        if (nextRun.getTime() < now.getTime()) {
            nextRun.setDate(nextRun.getDate() + 1);
        }

        const previousRun = new Date(nextRun);
        previousRun.setDate(previousRun.getDate() - 1);

        return {
            id: id,
            name: name,
            nextRun: nextRun,
            previousRun: previousRun,
            previousRunStatus: 'success',
            currentRunning: false,
            isScheduled: false,
            errorLog: 'No',
            // Store the default hour and minute
            defaultHour: hour,
            defaultMinute: minute
        };
    }

    // Initial job data with dynamic dates and a default 'No' error log
    let jobs = [
        createJob(1, 'Add Periodic Accrual Transactions', 0, 15), // Updated to 12:15 AM
        createJob(2, 'Auto Payment From Savings', 19, 30),
        createJob(3, 'Center Workflow Next Loan Cycle', 5, 30),
        createJob(4, 'Check For Dormant Users', 1, 0),
        createJob(5, 'Eod Process', 20, 30),
        createJob(6, 'Gst DB push', 21, 10),
        createJob(7, 'Make Loan as FLDG After DPD limit', 1, 5),
        createJob(8, 'OFSAA Move staging data to Archive and update accruals (BOD)', 6, 0),
        createJob(9, 'OFSAA Update staging on loan events', 1, 11), // Updated to 01:11 AM
        createJob(10, 'Post Overdue Receivable Due', 21, 20),
        createJob(11, 'Process Batch Accounting Transactions', 1, 10), // Updated to 01:10 AM
        createJob(12, 'Process Npa Loans Details', 1, 0),
        createJob(13, 'Push Transactions to BC Portal', 22, 30),
        createJob(14, 'Sync Banking Offices with BC', 4, 0),
        createJob(15, 'Update Loan Arrears Ageing', 0, 1), // Updated to 12:01 AM
    ];

    /**
     * Renders a toast notification to the user.
     * @param {string} message The message to display.
     * @param {string} type The type of toast ('success', 'error', 'info').
     */
    function showToast(message, type) {
        const toast = document.createElement('div');
        let bgColor = 'bg-blue-500';
        let icon = '';

        if (type === 'success') {
            bgColor = 'bg-green-500';
            icon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                    </svg>`;
        } else if (type === 'error') {
            bgColor = 'bg-red-500';
            icon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                    </svg>`;
        } else { // info
            bgColor = 'bg-blue-500';
            icon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2h1a1 1 0 011 1v3a1 1 0 11-2 0v-1a1 1 0 00-1-1H9a1 1 0 010-2h1zm2 1a1 1 0 100 2h1a1 1 0 000-2h-1z" clip-rule="evenodd" />
                    </svg>`;
        }

        toast.className = `flex items-center space-x-2 text-white px-4 py-3 rounded-xl shadow-lg mb-2 transition-transform transform translate-x-full duration-500 ${bgColor}`;
        toast.innerHTML = `${icon}<span>${message}</span>`;
        toastContainer.appendChild(toast);

        setTimeout(() => {
            toast.classList.remove('translate-x-full');
        }, 10);

        setTimeout(() => {
            toast.classList.add('translate-x-full');
            toast.addEventListener('transitionend', () => {
                toast.remove();
            });
        }, 5000);
    }

    /**
     * Shows a specific page and hides all others, and updates navigation links.
     * @param {Event} event The click event.
     * @param {string} pageId The ID of the page to show.
     */
    function showPage(event, pageId) {
        event.preventDefault(); // Prevent the default anchor tag behavior

        // Hide all pages
        pages.forEach(page => {
            page.classList.add('hidden');
        });
        // Show the requested page
        const pageToShow = document.getElementById(pageId + '-page');
        if (pageToShow) {
            pageToShow.classList.remove('hidden');
        }

        // Deactivate all navigation links
        navLinks.forEach(link => {
            link.classList.remove('font-bold', 'text-blue-700');
            link.classList.add('text-gray-700');
        });
        sidebarLinks.forEach(link => {
            link.classList.remove('bg-indigo-50', 'text-indigo-600');
            link.classList.add('text-gray-400');
        });

        // Activate the correct navigation link based on pageId
        const activeNavLink = document.getElementById(`${pageId}-nav-link`);
        if (activeNavLink) {
            activeNavLink.classList.add('font-bold', 'text-blue-700');
            activeNavLink.classList.remove('text-gray-700');
        }
        const activeSidebarLink = document.querySelector(`[onclick="showPage(event, '${pageId}')"].nav-link-sidebar`);
        if (activeSidebarLink) {
            activeSidebarLink.classList.add('bg-indigo-50', 'text-indigo-600');
            activeSidebarLink.classList.remove('text-gray-400');
        }

        // Special case for reports page: render jobs table and set default tab
        if (pageId === 'reports') {
            renderReportsTable();
        }
    }

    // Since there's only one tab, this function is simplified to just render the table.
    function showReportTab() {
        renderReportsTable();
    }

    /**
     * Renders the single reports table with all jobs.
     */
    function renderReportsTable() {
        allJobsTableBody.innerHTML = '';
        if (jobs.length === 0) {
            allJobsTableBody.innerHTML = `<tr><td colspan="6" class="text-center py-4 text-gray-500">No reports found.</td></tr>`;
            return;
        }

        jobs.forEach(job => {
            let statusBadge = 'N/A'; // Default status
            let previousRunHtml = 'N/A';
            let errorLogHtml = `<span class="text-gray-500">No</span>`;

            // This is the updated logic to prioritize the "Running" status
            if (job.currentRunning) {
                statusBadge = `<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">Running</span>`;
            } else if (job.isScheduled) {
                statusBadge = `<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">Scheduled</span>`;
            } else if (job.previousRunStatus === 'success') {
                statusBadge = `<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Success</span>`;
            } else if (job.previousRunStatus === 'fail') {
                statusBadge = `<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">Failed</span>`;
            }

            // Display previous run date, now with normal font-weight
            if (job.previousRun) {
                previousRunHtml = `<span class="text-gray-900">${formatDateTime(job.previousRun)}</span>`;
            }

            // Display error log
            if (job.errorLog && job.errorLog !== 'No') {
                errorLogHtml = `<span class="text-red-500 font-medium">${job.errorLog}</span>`;
            }

            // Spinner for running jobs, displayed next to the job name
            const spinner = job.currentRunning ? `
                <svg class="animate-spin h-4 w-4 ml-2 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>` : '';

            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                    <div class="flex items-center">
                        <span>${job.name}</span>
                        ${spinner}
                    </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm">${statusBadge}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${job.nextRun ? formatDateTime(job.nextRun) : '-'}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${previousRunHtml}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm">
                    ${errorLogHtml}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                    <button onclick="rerunJob(event, ${job.id})" class="text-sm px-4 py-2 rounded-lg text-white bg-blue-600 hover:bg-blue-700 transition-colors">Rerun</button>
                    <button onclick="openRescheduleModal(event, ${job.id})" class="text-sm px-4 py-2 rounded-lg text-white bg-yellow-600 hover:bg-yellow-700 transition-colors ml-2">Reschedule</button>
                    <button onclick="downloadReport(event, ${job.id})" class="text-sm px-4 py-2 rounded-lg text-white bg-green-600 hover:bg-green-700 transition-colors ml-2">Download</button>
                </td>
            `;
            allJobsTableBody.appendChild(row);
        });
    }

    /**
     * Formats a Date object to a readable string (e.g., Aug 3, 2025 01:00 AM).
     * @param {Date} date The date object to format.
     */
    function formatDateTime(date) {
        const options = {
            year: 'numeric',
            month: 'short',
            day: 'numeric',
            hour: 'numeric',
            minute: 'numeric',
            hour12: true
        };
        return date.toLocaleDateString('en-US', options);
    }

    /**
     * Opens the reschedule modal and populates it with job data.
     * @param {Event} event The click event.
     * @param {number} jobId The ID of the job to reschedule.
     */
    function openRescheduleModal(event, jobId) {
        event.preventDefault();
        const job = jobs.find(j => j.id === jobId);
        if (!job) return;

        rescheduleJobIdInput.value = jobId;
        const now = new Date();
        const formattedDate = now.toISOString().split('T')[0];
        const formattedTime = now.toTimeString().split(' ')[0].substring(0, 5);

        rescheduleDateInput.value = formattedDate;
        rescheduleTimeInput.value = formattedTime;
        failJobCheckbox.checked = false;
        
        rescheduleModal.classList.remove('hidden');
    }

    /**
     * Closes the reschedule modal.
     */
    function closeRescheduleModal() {
        rescheduleModal.classList.add('hidden');
    }

    /**
     * Simulates a job rerun.
     * @param {Event} event The click event.
     * @param {number} jobId The ID of the job to rerun.
     */
    function rerunJob(event, jobId) {
        event.preventDefault();
        const job = jobs.find(j => j.id === jobId);
        if (!job) return;
        
        // Start the job simulation immediately
        job.currentRunning = true;
        job.previousRunStatus = null;
        job.errorLog = 'No';
        showToast(`Rerunning job: ${job.name}`, 'info');
        renderReportsTable();

        // Simulate job completion after a delay of 10 seconds
        setTimeout(() => {
            job.currentRunning = false;
            job.previousRun = new Date();
            job.previousRunStatus = 'success';
            job.errorLog = 'No';

            // IMPORTANT: Rerunning a job does not affect the next scheduled run.
            // The `nextRun` value is preserved.

            showToast(`Job "${job.name}" completed successfully.`, 'success');
            renderReportsTable();
        }, 10000); 
    }

    /**
     * Simulates downloading a CSV file.
     * @param {Event} event The click event.
     * @param {number} jobId The ID of the report job.
     */
    function downloadReport(event, jobId) {
        event.preventDefault();
        const job = jobs.find(j => j.id === jobId);
        if (!job) return;

        const csvContent = `id,name,value\n1,"${job.name}",100\n2,"${job.name}",200`;
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        
        // Get current date for filename
        const now = new Date();
        const formattedDate = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
        const filename = `${job.name.replace(/\s/g, '_')}_${formattedDate}.csv`;

        link.download = filename;
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        showToast(`Simulating download for job: ${job.name}`, 'info');
    }

    // Event listener for the login form
    loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        if (users[username] && users[username] === password) {
            loginPage.classList.add('hidden');
            mainApp.classList.remove('hidden');
            showPage(e, 'dashboard'); // Default to the dashboard page after login
        } else {
            loginError.classList.remove('hidden');
        }
    });

    // Event handler for the reschedule form
    function handleRescheduleSubmit(event) {
        event.preventDefault();
        const jobId = parseInt(rescheduleJobIdInput.value);
        const newDate = rescheduleDateInput.value;
        const newTime = rescheduleTimeInput.value;
        const failJob = failJobCheckbox.checked;

        const job = jobs.find(j => j.id === jobId);
        if (!job) return;
        
        const scheduledTime = new Date(`${newDate}T${newTime}`);
        const now = new Date();
        const delay = scheduledTime.getTime() - now.getTime();
        
        // Update the next run time and set the status to "Scheduled"
        job.nextRun = scheduledTime;
        job.previousRunStatus = null;
        job.errorLog = 'No';
        job.isScheduled = true;
        
        showToast(`Job "${job.name}" has been scheduled for ${formatDateTime(scheduledTime)}.`, 'info');
        closeRescheduleModal();
        renderReportsTable();

        // If the scheduled time is in the future, set a timer
        if (delay > 0) {
            setTimeout(() => {
                // When the timer finishes, the job starts running
                job.currentRunning = true;
                job.isScheduled = false; // Reset scheduled status
                showToast(`Scheduled job "${job.name}" is now running.`, 'info');
                renderReportsTable();

                // Simulate job completion after a 10 second delay
                setTimeout(() => {
                    job.currentRunning = false;
                    job.previousRun = new Date();
                    
                    if (failJob) {
                        job.previousRunStatus = 'fail';
                        job.errorLog = 'Job failed as configured during scheduling.';
                        showToast(`Job "${job.name}" failed.`, 'error');
                    } else {
                        job.previousRunStatus = 'success';
                        job.errorLog = 'No';
                        showToast(`Job "${job.name}" completed successfully.`, 'success');
                        
                        // After successful completion, reset to the default schedule
                        const defaultNextRun = new Date(job.previousRun);
                        defaultNextRun.setDate(defaultNextRun.getDate() + 1);
                        defaultNextRun.setHours(job.defaultHour);
                        defaultNextRun.setMinutes(job.defaultMinute);
                        job.nextRun = defaultNextRun;
                    }
                    renderReportsTable();
                }, 10000); // 10 seconds
            }, delay);
        } else {
             // If scheduled time is in the past or now, run immediately
             job.currentRunning = true;
             job.isScheduled = false; // Reset scheduled status
             showToast(`Job "${job.name}" is running now.`, 'info');
             renderReportsTable();

             setTimeout(() => {
                job.currentRunning = false;
                job.previousRun = new Date();

                if (failJob) {
                    job.previousRunStatus = 'fail';
                    job.errorLog = 'Job failed as configured during scheduling.';
                    showToast(`Job "${job.name}" failed.`, 'error');
                } else {
                    job.previousRunStatus = 'success';
                    job.errorLog = 'No';
                    showToast(`Job "${job.name}" completed successfully.`, 'success');

                    // After successful completion, reset to the default schedule
                    const defaultNextRun = new Date(job.previousRun);
                    defaultNextRun.setDate(defaultNextRun.getDate() + 1);
                    defaultNextRun.setHours(job.defaultHour);
                    defaultNextRun.setMinutes(job.defaultMinute);
                    job.nextRun = defaultNextRun;
                }
                renderReportsTable();
             }, 10000);
        }
    }

    // Initial setup on page load
    window.addEventListener('load', () => {
        // For this application, we show the login page first.
    });
</script>
</body>
</html>
